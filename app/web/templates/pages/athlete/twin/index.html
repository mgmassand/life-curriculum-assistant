{% extends "athlete_base.html" %}

{% block title %}Digital Athlete Twin - AthleteLife 360{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="md:flex md:items-center md:justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Digital Athlete Twin</h1>
            <p class="mt-1 text-gray-500">Complete picture, one dashboard</p>
        </div>
    </div>

    {% if athletes %}
    <!-- Athlete Selector -->
    <div class="bg-white rounded-xl shadow p-4 mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Athlete</label>
        <select id="athlete-select" onchange="window.location.href='/athlete/twin?athlete_id=' + this.value" class="w-full rounded-lg border-gray-300 focus:ring-athlete-orange-500 focus:border-athlete-orange-500">
            {% for athlete in athletes %}
            <option value="{{ athlete.id }}" {% if selected_athlete and selected_athlete.id == athlete.id %}selected{% endif %}>
                {{ athlete.child.name }} - {{ athlete.primary_sport.name if athlete.primary_sport else "Multi-Sport" }}
            </option>
            {% endfor %}
        </select>
    </div>

    {% if selected_athlete %}
    <!-- Athlete Header Card -->
    <div class="bg-gradient-to-r from-athlete-blue-600 to-athlete-orange-500 rounded-xl shadow-lg p-6 mb-8 text-white">
        <div class="flex items-center space-x-6">
            <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center text-4xl font-bold">
                {{ selected_athlete.child.name[0] }}
            </div>
            <div class="flex-1">
                <h2 class="text-3xl font-bold">{{ selected_athlete.child.name }}</h2>
                <p class="text-white/80 text-lg">
                    {{ selected_athlete.primary_sport.name if selected_athlete.primary_sport else "Multi-Sport Athlete" }}
                    {% if selected_athlete.position %} | {{ selected_athlete.position }}{% endif %}
                </p>
                <div class="flex items-center space-x-4 mt-2 text-sm text-white/70">
                    {% if selected_athlete.graduation_year %}
                    <span>Class of {{ selected_athlete.graduation_year }}</span>
                    {% endif %}
                    {% if selected_athlete.target_division %}
                    <span>| Target: {{ selected_athlete.target_division }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="text-right">
                <div class="text-5xl font-bold">360</div>
                <div class="text-sm text-white/70">Digital Twin</div>
            </div>
        </div>
    </div>

    <!-- Four Data Streams Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Physiological Stream -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="bg-green-500 px-6 py-3">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Physiological
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">
                            {% if selected_athlete.height_inches %}
                            {{ selected_athlete.height_inches // 12 }}'{{ selected_athlete.height_inches % 12 }}"
                            {% else %}--{% endif %}
                        </p>
                        <p class="text-xs text-gray-500">Height</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">{{ selected_athlete.weight_lbs or '--' }}</p>
                        <p class="text-xs text-gray-500">Weight (lbs)</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">--</p>
                        <p class="text-xs text-gray-500">PHV Status</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">--</p>
                        <p class="text-xs text-gray-500">Growth Rate</p>
                    </div>
                </div>
                <a href="/athlete/growth" class="mt-4 block text-center text-sm text-green-600 hover:text-green-700">
                    View Growth Spurt Guardian &rarr;
                </a>
            </div>
        </div>

        <!-- Logistical Stream -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="bg-blue-500 px-6 py-3">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Logistical
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-blue-600">--</p>
                        <p class="text-xs text-gray-500">Weekly Hours</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-blue-600">--</p>
                        <p class="text-xs text-gray-500">Rest Days</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-blue-600">--</p>
                        <p class="text-xs text-gray-500">Injury Risk</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-blue-600">--</p>
                        <p class="text-xs text-gray-500">ACWR</p>
                    </div>
                </div>
                <a href="/athlete/playometer" class="mt-4 block text-center text-sm text-blue-600 hover:text-blue-700">
                    View Play-o-Meter &rarr;
                </a>
            </div>
        </div>

        <!-- Academic Stream -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="bg-purple-500 px-6 py-3">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                    Academic
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-purple-600">
                            {% if selected_athlete.academic_records %}
                            {{ selected_athlete.academic_records[-1].gpa or '--' }}
                            {% else %}--{% endif %}
                        </p>
                        <p class="text-xs text-gray-500">Overall GPA</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-purple-600">
                            {% if selected_athlete.academic_records %}
                            {{ selected_athlete.academic_records[-1].core_gpa or '--' }}
                            {% else %}--{% endif %}
                        </p>
                        <p class="text-xs text-gray-500">Core GPA</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-purple-600">--/16</p>
                        <p class="text-xs text-gray-500">Core Courses</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-purple-600">--</p>
                        <p class="text-xs text-gray-500">Eligibility</p>
                    </div>
                </div>
                <a href="/athlete/academics" class="mt-4 block text-center text-sm text-purple-600 hover:text-purple-700">
                    View Academics &rarr;
                </a>
            </div>
        </div>

        <!-- Subjective Stream -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="bg-orange-500 px-6 py-3">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Subjective
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-orange-600">--/5</p>
                        <p class="text-xs text-gray-500">Fun Score</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-orange-600">--/5</p>
                        <p class="text-xs text-gray-500">Energy Level</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-orange-600">--</p>
                        <p class="text-xs text-gray-500">Fun Trend</p>
                    </div>
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <p class="text-2xl font-bold text-orange-600">--%</p>
                        <p class="text-xs text-gray-500">Want Repeat</p>
                    </div>
                </div>
                <a href="/athlete/checkin" class="mt-4 block text-center text-sm text-orange-600 hover:text-orange-700">
                    View Fun Check-ins &rarr;
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Actions Row -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <a href="/athlete/playometer" class="bg-white rounded-xl shadow p-4 hover:shadow-lg transition-shadow text-center">
            <div class="text-3xl mb-2">&#x23F1;</div>
            <p class="font-medium text-gray-900">Play-o-Meter</p>
            <p class="text-xs text-gray-500">Track activity</p>
        </a>
        <a href="/athlete/checkin" class="bg-white rounded-xl shadow p-4 hover:shadow-lg transition-shadow text-center">
            <div class="text-3xl mb-2">&#x1F60A;</div>
            <p class="font-medium text-gray-900">Fun Check-in</p>
            <p class="text-xs text-gray-500">Rate enjoyment</p>
        </a>
        <a href="/athlete/chat" class="bg-white rounded-xl shadow p-4 hover:shadow-lg transition-shadow text-center">
            <div class="text-3xl mb-2">&#x1F4AC;</div>
            <p class="font-medium text-gray-900">AthleTEQ AI</p>
            <p class="text-xs text-gray-500">Ask anything</p>
        </a>
        <a href="/athlete/athletes/{{ selected_athlete.id }}" class="bg-white rounded-xl shadow p-4 hover:shadow-lg transition-shadow text-center">
            <div class="text-3xl mb-2">&#x2699;</div>
            <p class="font-medium text-gray-900">Edit Profile</p>
            <p class="text-xs text-gray-500">Update info</p>
        </a>
    </div>

    <!-- Training & Recruitment Summary -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Active Training Plans -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Active Training Plans</h3>
                <a href="/athlete/training" class="text-sm text-athlete-orange-600 hover:text-athlete-orange-700">View All</a>
            </div>
            {% if selected_athlete.training_plan_assignments %}
            <div class="space-y-3">
                {% for assignment in selected_athlete.training_plan_assignments[:3] %}
                <div class="p-3 border rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium text-gray-900">{{ assignment.training_plan.name }}</p>
                            <p class="text-sm text-gray-500">Week {{ assignment.current_week }} of {{ assignment.training_plan.duration_weeks }}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full {% if assignment.status == 'active' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ assignment.status|title }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-center text-gray-500 py-4">No active training plans</p>
            {% endif %}
        </div>

        <!-- Recruitment Status -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Recruitment Status</h3>
                <a href="/athlete/recruitment" class="text-sm text-athlete-orange-600 hover:text-athlete-orange-700">View All</a>
            </div>
            <div class="text-center p-4 bg-gray-50 rounded-lg mb-4">
                <p class="text-sm text-gray-500">Current Status</p>
                <p class="text-xl font-bold text-gray-900">{{ (selected_athlete.recruitment_status or 'exploring')|replace('_', ' ')|title }}</p>
            </div>
            {% if selected_athlete.recruitment_contacts %}
            <div class="space-y-2">
                <p class="text-sm text-gray-500">Recent Contacts</p>
                {% for contact in selected_athlete.recruitment_contacts[:3] %}
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-sm font-medium">{{ contact.college_name }}</span>
                    <span class="text-xs text-gray-500">{{ contact.division }}</span>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-center text-gray-500 py-2">No recruitment contacts yet</p>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-12 bg-white rounded-xl shadow">
        <p class="text-gray-500">Select an athlete above to view their Digital Twin</p>
    </div>
    {% endif %}
    {% else %}
    <div class="text-center py-12 bg-white rounded-xl shadow">
        <div class="text-6xl mb-4">&#x1F3C3;</div>
        <h3 class="text-lg font-medium text-gray-900">No athletes yet</h3>
        <p class="mt-2 text-gray-500">Create an athlete profile to view their Digital Twin.</p>
        <a href="/athlete/dashboard" class="mt-4 inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-athlete-orange-600 rounded-lg hover:bg-athlete-orange-700">
            Go to Dashboard
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
